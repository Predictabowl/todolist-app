<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head th:replace="fragments/layouts :: app-common-header(~{::title})">
	<title>Projects</title>
</head>
<body>
	<div th:replace="fragments/layouts :: app-layout(${user.username}, ~{::#content}, ${projects})">
		<div id="content">
			<div th:if="${activeProject != null}" id="active-project-section">
				<div class="is-flex is-justify-content-space-between">
					<h1 class="title" th:text="${activeProject.name}"></h1>
					<div class="dropdown is-hoverable is-right">
						<div class="dropdown-trigger">
							<span
								class="button is-rounded is-light is-info">
								<em class="fas fa-ellipsis"></em>
							</span>
						</div>
						<div class="dropdown-menu">
							<div class="dropdown-content">
								<a class="dropdown-item" id="toggle-completed-tasks">
									<span th:text="#{show.completed.tasks}" id="show-task-label"></span>
									<span class="is-not-displayed" th:text="#{hide.completed.tasks}" id="hide-task-label"></span>
								</a>
							</div>
						</div>
					</div>
				</div>
				<ul id="tasks-list">
					<li class="box" th:each="task : ${tasks}">
						<div th:replace="fragments/commons :: toggleTaskCompletedForm(${activeProject}, ${task}, 'is-success')">
						</div>
					</li>
				</ul>
				
				<div class="mt-5">
					<a href="#" class="button is-primary is-outlined is-rounded" id="add-task-link">
						<span class="icon">
							<em class="fas fa-plus"></em>
						</span>
						<span
							th:text="#{add.task}">
						</span>
					</a>
					<div class="box is-not-displayed" id="new-task-form-container">
						<form th:action="@{/web/project/{id}/task/new (id=${activeProject.id})}" 
								name="new-task-form" method="post"
								th:object="${newTaskWebDto}">
							<div class="field" th:insert="fragments/commons::inputWithField('name', 'Name', 'text')"></div>
							<div class="field">
								<textarea class="textarea" placeholder="Description" name="description" ></textarea>
								<label class="help is-danger"	th:if="${#fields.hasErrors('description')}" th:id="'input-helper-description'" th:errors="*{'description'}"></label>
							</div>
							<div class="control">
								<button class="button is-success is-rounded" type="submit" name="submit-button" th:text="#{add}"></button>
								<button class="button is-rounded" type="button" name="cancel-button" id="close-new-task-form" th:text="#{cancel}"></button>
							</div>
						</form>
					</div>
				</div>


				<div class="mt-5 p-2 has-background-warning is-not-displayed" id="completed-tasks">
					<ul id="completed-tasks-list">
						<li class="box" th:each="task : ${completedTasks}">
							<div th:replace="fragments/commons :: toggleTaskCompletedForm(${activeProject}, ${task}, 'is-danger')">
							</div>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
	
	<script type="text/javascript">
		$("#add-task-link, #close-new-task-form").click(function(){
			$("#add-task-link").toggle();
			$("#new-task-form-container").toggle();
		})
		$("#toggle-completed-tasks").click(function(){
			$("#completed-tasks").toggle("slow", function(){
				$("#show-task-label").toggle();
				$("#hide-task-label").toggle();
				localStorage.setItem("hiddenCompletedTasks", $("#completed-tasks").css("display") == "none");
			});
		})
		
		$("completed-tasks").ready(function(){
			if (localStorage.getItem("hiddenCompletedTasks") == "false"){
				$("#completed-tasks").show();
				$("#show-task-label").hide();
				$("#hide-task-label").show();
			}
		})
	</script>

</body>
</html>